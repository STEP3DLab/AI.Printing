<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D-Print Cost Estimator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/styles.css" />
<script type="module">
  import * as THREE from './js/lib/three.module.min.js';
  import { STLLoader } from './js/lib/STLLoader.js';
  import { OrbitControls } from './js/lib/OrbitControls.js';
  window.THREE = THREE;
  window.STLLoader = STLLoader;
  window.OrbitControls = OrbitControls;
</script>
</head>
<body class="container">
<h1 class="mb-4">Калькулятор стоимости&nbsp;3D-печати (FDM / DLP)</h1>
<div class="row g-4">
  <div class="col-lg-4">
    <label class="form-label">STL-файл</label>
    <input class="form-control" type="file" id="fileInput" accept=".stl" />
    <input class="form-control mt-2" type="url" id="fileUrl" placeholder="URL" />
    <div id="dropZone" class="mt-2 p-3 border rounded text-center text-muted">Перетащите файл сюда</div>
  </div>
  <div class="col-lg-4">
    <label class="form-label">Целевой наибольший габарит, мм</label>
    <input class="form-control" type="number" step="0.1" min="0" id="targetMax" value="100" />
  </div>
  <div class="col-lg-4 align-self-end">
    <button id="calcBtn" class="btn btn-primary w-100">Рассчитать</button>
  </div>
</div>
<hr class="my-4" />
<h4>Параметры стоимости</h4>
<div class="row g-3">
  <div class="col-6 col-lg-2"><label class="form-label small">Цена филамента ₽/см³</label><input id="priceFilament" class="form-control" type="number" step="0.1" value="4"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Цена смолы ₽/см³</label><input id="priceResin" class="form-control" type="number" step="0.1" value="14"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Время&nbsp;FDM ч/см³</label><input id="timeCoefFdm" class="form-control" type="number" step="0.001" value="0.04"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Время&nbsp;DLP ч/см³</label><input id="timeCoefDlp" class="form-control" type="number" step="0.001" value="0.02"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Стоимость часа ₽/ч</label><input id="priceMachine" class="form-control" type="number" step="1" value="150"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Инфил, %</label><input id="infill" class="form-control" type="number" step="1" value="100"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Поддержки, %</label><input id="supportPct" class="form-control" type="number" step="1" value="10"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Копий</label><input id="copies" class="form-control" type="number" step="1" value="1"></div>
  <div class="col-6 col-lg-2"><label class="form-label small">Упаковка, ₽</label><input id="packCost" class="form-control" type="number" step="1" value="0"></div>
</div>
<div id="progress" class="my-3 text-muted"></div>
<div id="results" class="my-4" style="display:none;">
  <h4>Результаты</h4>
  <div class="row g-3 mb-3">
    <div class="col-6 col-lg-3"><div class="card text-center result-card"><div class="card-body"><h5 class="card-title">Цена&nbsp;FDM</h5><p id="costFdmElem" class="fs-4 mb-0"></p></div></div></div>
    <div class="col-6 col-lg-3"><div class="card text-center result-card"><div class="card-body"><h5 class="card-title">Цена&nbsp;DLP</h5><p id="costDlpElem" class="fs-4 mb-0"></p></div></div></div>
    <div class="col-6 col-lg-3"><div class="card text-center result-card"><div class="card-body"><h5 class="card-title">Масштаб</h5><p id="scaleOut" class="fs-4 mb-0"></p></div></div></div>
    <div class="col-6 col-lg-3"><div class="card text-center result-card"><div class="card-body"><h5 class="card-title">Объём, см³</h5><p id="volOut" class="fs-4 mb-0"></p></div></div></div>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <thead class="table-light"><tr><th></th><th>X, мм</th><th>Y, мм</th><th>Z, мм</th></tr></thead>
      <tbody>
        <tr><th scope="row">Исходный размер</th><td id="sx"></td><td id="sy"></td><td id="sz"></td></tr>
        <tr><th scope="row">После масштабирования</th><td id="gx"></td><td id="gy"></td><td id="gz"></td></tr>
      </tbody>
    </table>
  </div>
</div>
<canvas id="previewCanvas" class="mt-4"></canvas>
<script type="module" src="js/app.js"></script>
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}</script>
</body>
</html>
